name = "unstage-api"
main = "src/index.ts"
compatibility_flags = [ "nodejs_compat", "nodejs_compat_populate_process_env" ]
compatibility_date = "2025-07-30"

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# Production environment
[env.production]
name = "unstage-api-production"

[env.production.vars]
NODE_ENV = "production"
PORT = "8787"
LOG_LEVEL = "info"
BETTER_AUTH_URL = "https://app.unstage.dev"
ALLOWED_API_ORIGINS = "https://unstage.dev,https://app.unstage.dev"
SKIP_ENV_VALIDATION = "true"

[[env.production.unsafe.bindings]]
name = "UNSTAGE_RATE_LIMITER"
type = "ratelimit"
namespace_id = "1001"
simple = { limit = 100, period = 60 }

# Staging environment (optional)
[env.staging]
name = "unstage-api-staging"
routes = [
  { pattern = "api-staging.unstage.dev/*", zone_name = "unstage.dev" }
]

[env.staging.vars]
NODE_ENV = "development"
PORT = "8787"
LOG_LEVEL = "debug"
BETTER_AUTH_URL = "http://localhost:3001"
ALLOWED_API_ORIGINS = "https://unstage.dev,https://app.unstage.dev,http://localhost:3000,http://localhost:3001"

# Rate limiting binding
[[unsafe.bindings]]
name = "UNSTAGE_RATE_LIMITER"
type = "ratelimit"
namespace_id = "1001"
simple = { limit = 100, period = 60 }

